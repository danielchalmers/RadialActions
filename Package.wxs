<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Radial Actions"
           Manufacturer="Daniel Chalmers"
           Version="$(var.Version)"
           UpgradeCode="EB19552B-9520-4638-9459-D2D257B52D05"
           Scope="perUser">
    <Property Id="ARPNOMODIFY" Value="1" />
    <MajorUpgrade AllowSameVersionUpgrades="yes"
                  DowngradeErrorMessage="A newer version of Radial Actions is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <CustomAction Id="LaunchApp"
                  Directory="INSTALLFOLDER"
                  ExeCommand="&quot;[INSTALLFOLDER]RadialActions.exe&quot;"
                  Execute="immediate"
                  Impersonate="yes"
                  Return="asyncNoWait" />

    <InstallExecuteSequence>
      <Custom Action="LaunchApp" After="InstallFinalize" Condition="NOT Installed" />
    </InstallExecuteSequence>

    <Feature Id="Main" Title="RadialActions" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
  </Package>

  <Fragment>
    <StandardDirectory Id="LocalAppDataFolder">
      <Directory Id="RadialActionsRoot" Name="RadialActions">
        <Directory Id="INSTALLFOLDER" Name="RadialActions" />
      </Directory>
    </StandardDirectory>
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ProgramMenuRadialActions" Name="Radial Actions" />
    </StandardDirectory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="MainExecutable" Guid="*">
        <File Id="RadialActionsExe" Source="publish/$(var.Arch)/RadialActions.exe" KeyPath="yes" />
        <RemoveFile Id="RemoveOldFiles" Name="*.*" On="both" />
        <RemoveFolder Id="RemoveInstallFolder" Directory="INSTALLFOLDER" On="uninstall" />
      </Component>
      <Component Id="StartMenuShortcut" Guid="*">
        <Shortcut Id="RadialActionsShortcut"
                  Name="Radial Actions"
                  Description="Radial Actions"
                  Directory="ProgramMenuRadialActions"
                  Target="[INSTALLFOLDER]RadialActions.exe"
                  WorkingDirectory="INSTALLFOLDER" />
        <RemoveFolder Id="RemoveStartMenuFolder" Directory="ProgramMenuRadialActions" On="uninstall" />
        <RegistryValue Root="HKCU"
                       Key="Software\\Daniel Chalmers\\RadialActions"
                       Name="StartMenuShortcut"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
      </Component>
      <Files Include="publish/$(var.Arch)/**">
        <Exclude Files="publish/$(var.Arch)/RadialActions.exe" />
      </Files>
    </ComponentGroup>
  </Fragment>
</Wix>
